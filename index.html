<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Automação Sala do Futuro</title>
<style>
    body { font-family: Arial, sans-serif; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; }
    .container { background: #222; padding: 20px; border-radius: 10px; width: 100%; max-width: 500px; margin-bottom: 20px; }
    input, button, textarea { width: 100%; padding: 10px; margin: 10px 0; border-radius: 5px; border: none; }
    input, textarea { background: #333; color: #fff; }
    button { background: #00aaff; color: #fff; cursor: pointer; }
    button:hover { background: #0088cc; }
    .output { background: #111; padding: 10px; border-radius: 5px; margin-top: 10px; max-height: 300px; overflow-y: auto; white-space: pre-wrap; }
</style>
</head>
<body>

<div class="container">
    <h2>Login Sala do Futuro</h2>
    <input type="text" id="ra" placeholder="RA">
    <input type="password" id="senha" placeholder="Senha">
    <button id="loginBtn">Login</button>
</div>

<div class="container">
    <h3>Tarefas</h3>
    <button id="carregarTarefasBtn">Carregar Tarefas</button>
    <div class="output" id="tarefasOutput"></div>
</div>

<div class="container">
    <h3>Gerar Respostas Automáticas</h3>
    <button id="responderTarefasBtn">Gerar respostas via IA</button>
    <div class="output" id="respostasOutput"></div>
</div>

<script>
let token = "";
let tarefas = [];

// Função para login na API
async function login() {
    const ra = document.getElementById("ra").value.trim();
    const senha = document.getElementById("senha").value.trim();
    if (!ra || !senha) { alert("Preencha RA e senha!"); return; }

    try {
        const response = await fetch("https://edusp-api.ip.tv:443/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ ra, senha })
        });
        const data = await response.json();
        if (data.token) {
            token = data.token;
            alert("Login bem-sucedido!");
        } else {
            alert("RA ou senha incorretos!");
        }
    } catch (e) {
        console.error(e);
        alert("Erro ao conectar com o servidor!");
    }
}

// Função para carregar tarefas
async function carregarTarefas() {
    if (!token) { alert("Faça login primeiro!"); return; }
    try {
        const response = await fetch("https://edusp-api.ip.tv:443/tarefas", {
            method: "GET",
            headers: { "Authorization": "Bearer " + token }
        });
        tarefas = await response.json();
        document.getElementById("tarefasOutput").innerText =
            tarefas.map((t, i) => `${i+1}. ${t.pergunta}`).join("\n\n");
    } catch (e) {
        console.error(e);
        alert("Erro ao carregar tarefas!");
    }
}

// Função para gerar respostas via IA e submeter
async function responderTarefas() {
    if (!tarefas.length) { alert("Carregue as tarefas primeiro!"); return; }
    const respostasDiv = document.getElementById("respostasOutput");
    respostasDiv.innerText = "Gerando respostas...\n";

    for (let i = 0; i < tarefas.length; i++) {
        const pergunta = tarefas[i].pergunta;
        let respostaIA = "";

        // Chamada para API de IA (ChatGPT)
        try {
            const response = await fetch("https://api.openai.com/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer SUA_CHAVE_OPENAI"
                },
                body: JSON.stringify({
                    model: "gpt-4-mini",
                    messages: [{ role: "user", content: pergunta }],
                    temperature: 0
                })
            });
            const data = await response.json();
            respostaIA = data.choices[0].message.content;
        } catch (e) {
            console.error(e);
            respostaIA = "Erro ao gerar resposta IA";
        }

        respostasDiv.innerText += `Pergunta ${i+1}: ${pergunta}\nResposta: ${respostaIA}\n\n`;

        // Enviar resposta para a API real
        try {
            await fetch("https://edusp-api.ip.tv:443/respostas", {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify({
                    tarefa_id: tarefas[i].id,
                    resposta: respostaIA
                })
            });
        } catch (e) {
            console.error(e);
        }
    }

    alert("Respostas geradas e enviadas!");
}

// Event listeners
document.getElementById("loginBtn").addEventListener("click", login);
document.getElementById("carregarTarefasBtn").addEventListener("click", carregarTarefas);
document.getElementById("responderTarefasBtn").addEventListener("click", responderTarefas);
</script>

</body>
</html>
